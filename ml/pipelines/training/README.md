# MAP Prediction Training Pipeline

Implements reproducible training and evaluation for the short-horizon MAP prediction and hypotension risk models. Pipelines align with the ML Lifecycle blueprint and produce artifacts suitable for regulatory review.

## Components

- `train.py` — Orchestrates data loading, feature engineering, model training, and MLflow logging.
- `configs/` — YAML configuration files defining datasets, hyperparameters, and acceptance thresholds.
- `notebooks/` — Exploratory analysis (kept under change control when promoted).

## Prerequisites

1. Approved access to de-identified retrospective ICU datasets.
2. Configured object storage (e.g., S3/MinIO) for artifacts.
3. MLflow tracking server endpoint under change control.

## Execution

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python train.py --config configs/baseline.yaml
```

By default, training now produces both:

- a runtime model binary: `artifacts/<run_id>/deploy/map_predictor.onnx`
- a deploy-ready artifact bundle including:
	- `deploy_manifest.json`
	- `feature_contract.json`
	- `acceptance_summary.json`
	- `deploy_bundle.json` (summary pointers)

Skip export if needed:

```bash
python train.py --config configs/baseline.yaml --skip-export
```

Register the deploy-ready artifact in the API model registry in the same command:

```bash
python train.py --config configs/baseline.yaml \
	--register-model \
	--registry-api-url http://localhost:8000 \
	--registry-jwt-secret dev-insecure-jwt-secret
```

## Synthetic Demo Data

Generate deterministic synthetic training data plus telemetry fixtures for end-to-end demos:

```bash
python run_synthetic_demo.py --output-dir demo_artifacts --dataset-format csv
python train.py --config demo_artifacts/configs/synthetic-baseline.yaml
```

Single-command demo for generate + train + package + registry registration:

```bash
python run_synthetic_demo.py \
	--output-dir demo_artifacts \
	--dataset-format csv \
	--run-training \
	--register-model \
	--registry-api-url http://localhost:8000 \
	--registry-jwt-secret dev-insecure-jwt-secret
```

The demo runner writes:

- `demo_artifacts/data/synthetic_icustays.csv` (or parquet)
- `demo_artifacts/fixtures/telemetry_stream.jsonl`
- `demo_artifacts/configs/synthetic-baseline.yaml`

All runs must be registered via the PCCP governance process. Validation reports generated by the pipeline feed into `docs/change-control/ml-pccp.md` artefacts.
